<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ploneboard">
      
<body>

   <metal:javascript fill-slot="javascript_head_slot">
     <script type="text/javascript"
              tal:attributes="src string:${portal_url}/moderation.js">
      </script>
   </metal:javascript>

    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
             tal:content="string: @import url($portal_url/ploneboard.css);"></style>
    </metal:css>

    <div metal:fill-slot="main">

        <div metal:use-macro="here/document_actions/macros/document_actions">
          Document actions (print, sendto etc)
        </div>

        <h2 tal:content="here/Title">Conversation title</h2>

        <metal:header use-macro="here/board_header/macros/header">Board header</metal:header>

        <div class="documentdescription"
             tal:content="here/Description"> 
        description
        </div>

        <div class="boardComment visualIEFloatFix"
             tal:define="comment python:context">
             
            <metal:comment metal:define-macro="comment"
                           tal:define="creator comment/Creator;
                                       creatorinfo python: mtool.getMemberInfo(creator);
                                       creation_date comment/creation_date;
                                       pss modules/Products/PythonScripts/standard">

                    <a tal:attributes="name comment/getId"></a>
                    <div class="boardCommentDetails" id=""
                         tal:attributes="id comment/getId">
                         <h3 tal:content="comment/Title">Post title</h3>
                    <img src="" 
                         tal:attributes="src string:${portal_url}/ploneboard_comment_icon.gif"/>
                         <span i18n:translate="posted_by" tal:omit-tag="">Posted by</span>
                         <span tal:replace="python:creatorinfo and creatorinfo['fullname'] or creator">author</span> 
                         <span i18n:translate="text_at" tal:omit-tag="">at</span>
                         <span tal:replace="python:here.toPloneboardTime(creation_date)"
                               >Thursday 13:21</span>
                    </div>
                
                    <div class="boardCommentBody">
                
                        <div class="portrait">
                          <tal:block define="portrait python: here.portal_membership.getPersonalPortrait(creator);"> 
                                <img class="portraitPhoto"
                                     src="defaultUser.gif" 
                                     alt="" 
                                     border="0" 
                                     width="75" 
                                     height="100" 
                                     tal:attributes="src portrait/absolute_url" />
                                <div tal:content="python:creatorinfo and creatorinfo['fullname'] or creator">member id</div>
                          </tal:block>
                        </div>
                        
                        <div class="boardCommentContent" 
                             tal:content="structure comment/getText">
                             Comment text.
                        </div>
                        
                    </div>


                    <div class="visualClear"></div>

                    <div class="boardCommentActions">

                      <form tal:condition="python:checkPermission('Ploneboard: Add Comment', here)"
                                    tal:attributes="action string:${comment/absolute_url}/add_comment_form#${comment/getId}">
                            <input class="standalone"
                                   type="submit" 
                                   value="Reply" 
                                   i18n:attributes="value"
                                   />

                        </form>

                      <form tal:condition="python:isAnon and not checkPermission('Ploneboard: Add Comment', here)"
                              tal:attributes="action python:'%s/login_form?came_from=%s' %
                                                            (here.portal_url(),
                                                            pss.url_quote(request['URL']))">

                            <input class="standalone" 
                                   type="submit" 
                                   value="Log in to add comments"
                                   i18n:attributes="value"
                                   />
                        </form>

                        <form tal:condition="python: checkPermission('Ploneboard: Edit Comment', here)" 
	                          tal:attributes="action string:${comment/absolute_url}/base_edit"> 
                            <input class="standalone" 
                                   type="submit" 
                                   value="Edit"
                                   i18n:attributes="value"
                                   />
                        </form>


                        <fieldset tal:define="attachments comment/getAttachments"
                                  tal:condition="attachments"
                                  style="text-align: left;">
                            <legend i18n:translate="legend_attachments">Attachments</legend>
                            <ul class="visualNoMarker">
                                <li tal:repeat="attachment attachments">
                                    <a tal:attributes="href attachment/absolute_url">
                                      <span tal:define="pt attachment/portal_type;
                                                        size python:here.getObjSize(attachment)"
                                              tal:attributes="class python:'contenttype-'+normalizeString(pt)">
                                        <span class="visualIconPadding"
                                              tal:content="attachment/title_or_id">
                                        Attachment title
                                        </span>
                                        <span tal:condition="size" tal:omit-tag="">
                                          (<span tal:replace="size">257 kB</span>)
                                        </span>
                                      </span>
                                    </a>
                                </li>
                            </ul>
                        </fieldset>

                    </div>

            </metal:comment>
        </div>
    </div>

</body>
</html>

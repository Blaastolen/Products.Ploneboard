<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ploneboard">
      
<head>
    <metal:css fill-slot="css_slot">
    <style type="text/css" media="all"
           tal:content="string: @import url($portal_url/ploneboard.css);"></style>
    </metal:css>
</head>

<body>

    <div metal:fill-slot="main"
         tal:define="conversations here/getConversations;
                     pss modules/Products/PythonScripts/standard;">


        <h1 class="documentFirstHeading">
        <img src="" tal:replace="structure here/ploneboard_forum_icon.gif" />
        <span tal:replace="here/Title">Forum title</span>
        </h1>

        <metal:header use-macro="here/board_header/macros/header">Board header</metal:header>

        <div class="documentDescription"
             tal:content="here/Description"> 
        Forum Description
        </div>
        
        <p class="discreet"
             i18n:translate="not_conversations"
             tal:condition="not: conversations">
        No conversations in this forum yet.     
        </p>

       <tal:block define="canStartConverstation python:checkPermission('Ploneboard: Add Comment', here) and checkPermission('Add portal content', here)">

        <form tal:attributes="action string:${here/absolute_url}/add_conversation_form"
              tal:condition="canStartConverstation">
              <input class="standalone"
                  i18n:attributes="value start_new_conversation"
                  type="submit" 
                  value="Start a new Conversation" />
        </form>

        <tal:choice condition="not: canStartConverstation">
        <form tal:condition="isAnon"
              tal:attributes="action python:'%s/login_form?came_from=%s' %
                                            (here.portal_url(),
                                            pss.url_quote(request['URL']))">

            <input class="standalone" 
                   type="submit" 
                   value="Log in to start a Conversation"
                   i18n:attributes="value log_to_start_conversation"
                   
                   />
        </form>

        <p class="discreet"
           i18n:translate="not_permission_start_conversation"
           tal:condition="not: isAnon">
        Sorry, you do not have permission to start a new Conversation
        </p>

        </tal:choice>
        </tal:block>

        <table class="listing"
               tal:condition="conversations">

            <thead>
                <tr>
                     <th i18n:translate="conversation">Conversation</th>
                     <th i18n:translate="replies">Replies</th>
                     <th i18n:translate="most_recent">Most Recent Comment</th>
                 </tr>
            </thead>
        
            <tbody>
                <tal:showconversations tal:repeat="conversation conversations">
                
                <tr tal:define="oddrow repeat/conversation/odd;
                                revstate python:wtool.getInfoFor(conversation, 'review_state', None);
                                nrcomments conversation/getNumberOfReplies"
                    tal:attributes="class python:test(oddrow, 'even', 'odd')">
                    <td>
                        <a href=""
                           class="listingConversation"
                           tal:attributes="href conversation/absolute_url">
                          <img src="" tal:condition="python:revstate in ['locked', 'locked_and_sticky']"
                                      tal:replace="structure here/lock_icon.gif" />
                            <span tal:replace="conversation/Title">This is a title</span>
                              

                            <div class="discreet" i18n:translate="label_by_author">
                                   by <tal:author i18n:name="author"
                                  tal:content="conversation/Creator" />
                            </div>
                            
                        </a>
                    </td>
                    
                    <td class="listingCheckbox"
                        tal:condition="nrcomments">
                        <span tal:content="nrcomments">
                            12 comments
                        </span>
                    </td>

                    <td class="listingCheckbox"
                        tal:condition="not: nrcomments">
                        <span i18n:translate="no_replies_yet">
                        No replies yet
                        </span>

                    </td>

                    <!-- This should show "Thursday 13:56" if in this week, "Aug 13. 2003" if older than this week. (limi) -->
                    <td>
                      <tal:block condition="nrcomments">
                         <div i18n:translate="label_by_author">
                             by <tal:author i18n:name="author"
                          tal:content="conversation/getLastCommentAuthor" />
                          </div>
                                                                                                                       

                        <span tal:content="python:here.toPloneboardTime(conversation.getLastCommentDate())">
                            Thursday 13:21
                        </span>
                      </tal:block>
                    </td>
    
                </tr>
                
                </tal:showconversations>
            </tbody>
        </table>

        <metal:footer use-macro="here/board_footer/macros/footer">Board footer</metal:footer>

    </div>
                     
</body>
</html>
